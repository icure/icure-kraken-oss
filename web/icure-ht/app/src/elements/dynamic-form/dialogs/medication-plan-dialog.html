<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/vaadin-material-theme/vaadin-grid.html">
<link rel="import" href="../../../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../../../bower_components/vaadin-button/vaadin-button.html">
<link rel="import" href="../../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../../../bower_components/vaadin-grid/vaadin-grid-column-group.html">
<link rel="import" href="../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../../dialog-style.html">
<link rel="import" href="../../../icd-styles.html">
<link rel="import" href="../../../scrollbar-style.html">

<dom-module id="medication-plan-dialog">
    <template>
        <style include="dialog-style icd-styles scrollbar-style">
            paper-dialog {
                width: 90%;
                height: 80%;
            }

            .modal-title {
                padding: 0 24px;
                display: flex;
                flex-flow: row wrap;
                justify-content: space-between;
                align-items: center;
            }

            paper-tabs {
                width: 50%;
                max-width: 400px;
                --paper-tabs-selection-bar-color: var(--app-secondary-color);
                /* margin: 0 auto; */
            }

            paper-tab {
                --paper-tab-ink: var(--app-secondary-color);
            }

            .patient {
                height: calc(100% - 48px - 48px);
                overflow-y: auto;
                margin-top: 0;
                padding: 24px;
                box-sizing: border-box;
            }

            .table-container {
                margin-bottom: 24px;
            }

            .header {
                background: linear-gradient(to right, var(--app-secondary-color), var(--app-secondary-color-dark));
                color: var(--app-text-color-light);
                display: flex; 
                flex-flow: row wrap;
                justify-content: flex-start;
                align-items: center;
                height: 40px;
                width: 100%;
                padding: 0 12px;
                box-sizing: border-box;
            }

            .header h3 {
                font-size: 14;
                font-weight: 400;
                margin: 0;
            }

            .header iron-icon {
                height: 20px;
                width: 20px;
                margin-right: 4px;
            }

            .table-header {
                width: 100%;
                display: flex;
                flex-flow: row nowrap;
                justify-content: space-between;
                align-items:center;
                border-bottom: 1px solid var(--app-background-color-dark);
                font-size: 11px;
                color: var(--app-text-color-disabled);
                height: 28px;
            }

            .col {
                height: 100%;
                padding: 0 4px;
                box-sizing: border-box;
                display: flex;
                flex-flow: row wrap;
                justify-content: center;
                align-items: center;
            }

            .col--med {
                width: 30%;
                justify-content: flex-start;
            }

            .med--name {
                font-weight: 500;
                margin-right: 4px;
            }

            .col--photo {
                max-width: 56px;
                min-width: 56px;
                text-align: center;
                flex-grow: 1;
            }

            .col--bef, .col--dur, .col--aft {
                max-width: 56px;
                min-width: 56px;
                text-align: center;
                flex-grow: 1;
            }

            .dur-pill {
                background: var(--app-secondary-color);
                color: var(--app-text-color-light);
                font-weight: 500;
                border-radius: 50%;
                padding: 4px;
                display: block;
                height: 12px;
                width: 12px;
                line-height: 1.1;
                text-align: center;
            }

            .col--ed, .col--freq {
                text-align: center;
                width: 12%;
            }

            .col--com {
                width: 40%;
                justify-content: flex-start;
            }

            .table-row {
                width: 100%;
                display: flex;
                flex-flow: row nowrap;
                justify-content: space-between;
                align-items:center;
                font-size: 12px;
                color: var(--app-text-color);
                height: 40px;
            }

            .table-row:nth-child(even) {
                background: var(--app-background-color-light);
            }

            .table-row .col:not(:last-child) {
                border-right: 1px solid var(--app-background-color-dark);
            }

            .general-infos {
                display: flex;
                flex-flow: row wrap;
                justify-content: flex-start;
                align-items: center;
                margin-bottom: 24px;
                background: var(--app-background-color-dark);
                padding: 12px;
                border-radius: 4px;
            }

            .infos-block {
                font-size: 14px;
                font-weight: 400;
                color: var(--app-text-color);
                margin-right: 24px;
            }

            .infos-block > div:first-child{
                margin-bottom: 8px;
            }

            .infos-block span {
                background: var(--app-background-color-light);
                border-radius: 12px;
                font-weight: 500;
                padding: 1px 8px;
                margin-right: 8px;
            }

            /* PRESENT */

            .table {
                display: flex;
                flex-flow: column nowrap;
                font-size: .8rem;
                margin: 0.5rem;
                line-height: 1.5;
                flex: 1 1 auto;
            }

            .th {
                display: none;
                font-weight: 700;
                background-color: var(--app-background-color- );
            }

            .th:first-child {
                border-top: 1px solid var(--app-background-color-dark);
            }


            .th > .td {
                white-space: nowrap;
                text-overflow: ellipsis;
                justify-content: center;
            }
            .th .td{
                color: var(--app-text-color);
            }

            .tr {
                position:relative;
                width: 100%;
                display: flex;
                flex-flow: row nowrap;
                color: var(--app-text-color);
                z-index:1;
                height: 24px;
            }

            .tr:not(.category):not(.th):not(.old) .td {
                color: var(--app-text-color-light);
            }

            .tr:not(.th):not(.category)::after {
                display:block;
                content:'';
                position:absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 100%;
                background: var(--paper-red-a200);
                z-index:0;
            }

            .tr:not(.td):nth-child(odd)::after {
                opacity: 0.6;
                transition: all .24s cubic-bezier(0.075, 0.82, 0.165, 1);
            }
            .tr:not(.td):nth-child(even)::after {
                opacity: 0.8;
                transition: all .24s cubic-bezier(0.075, 0.82, 0.165, 1);
            }

            .tr:not(.td):hover::after {
                opacity: 1;
            }

            .tr.old {
                color: var(--app-text-color-disabled)!important;
            }
            .tr.old::after {
                background: var(--app-background-color-light)!important;
            }

            .tr:not(.category) {
                color: var(--app-text-color-white);
            }

            .tr:nth-of-type(even) {
                background-color: var(--app-background-color-light);
            }

            .td {
                position: relative;
                display: flex;
                flex-flow: row nowrap;
                align-items: center;
                justify-content: center;
                flex-grow: 1;
                flex-basis: 0;
                padding: 0.5em;
                overflow: hidden;
                min-width: 0px;
                z-index: 2;
                word-break: break-word;
                white-space: nowrap;
                text-overflow: ellipsis;
                border-right: 1px solid var(--app-background-color-dark);
                font-size: 13px;
            }

            .td:first-child {
                border-left: 1px solid var(--app-background-color-dark);
            }

            .td--comments, .td--medicine, .td--category {
                justify-content: flex-start;
            }

            .td--category iron-icon {
                height: 14px;
                width: 14px;
                margin-right: 4px;
            }

            .th .td {
                border-bottom: 1px solid var(--app-background-color-dark);
            }

            .span-3 {
                padding: 6px 19px; /* 19px because we had the padding of the missings .td padding + their borders */
            }

            .category {
                border-bottom: 1px solid #d0d0d0;
            }

            .reimbursed iron-icon {
                height: 14px;
                width: 14px; 
                padding: 2px;
                border-radius: 50%;
                box-shadow: 0 0 0 rgba(0,0,0,.2);
                transition: all .24s cubic-bezier(0.075, 0.82, 0.165, 1);
                background-color: var(--app-text-color-light);
            }

            .reimbursed iron-icon:hover {
                height: 16px;
                width: 16px;
                box-shadow: 0 0 4px rgba(0,0,0,.2);
            }

            .reimbursed iron-icon.ok {
               color: var(--app-status-color-ok)
            }

            .reimbursed iron-icon.nok {
                color: var(--app-status-color-nok)
            }

            .reimbursed iron-icon.pending {
                color: var(--app-status-color-pending)
            }

            .add-period-btn {
                height: 16px;
                width: 16px;
                padding: 0;
                color: var(--app-text-color);
                transition: all .24s cubic-bezier(0.075, 0.82, 0.165, 1);
            }

            .add-period-btn:hover {
                height: 18px;
                width: 18px;
                color: var(--app-secondary-color);
            }


            /* HISTORY */

           .timeline-header{
                display: flex;
                flex-flow: row nowrap;
                justify-content: space-between;
                background: var(--app-background-color-light);
                border: 1px solid var(--app-background-color-dark);
           }

           .timeline div {
                box-sizing: border-box;
           }

           .years-container{
                max-width: calc(24px * 36 + 2px);
                width: calc(24px * 36 + 2px); /* 3 years + borders */
                overflow-x: auto;
                overflow-y: hidden;
                flex-grow: 1;
                display: flex;
                flex-flow: row nowrap;
                justify-content: flex-start;
                align-items: center;
                border-left: 1px solid var(--app-background-color-dark);
                border-right: 1px solid var(--app-background-color-dark);
                position: relative;
           }

           .year-block{
                height: 48px;
                min-width: calc(24px * 12 + 3px); /* 3 borders */
                text-align: center;
                display:flex;
                flex-flow: row wrap;
                justify-content: space-between;
                align-items: center;
           }

           .year-block:not(:last-child){
                border-right: 1px solid var(--app-background-color-dark);
           }

           .year-block.current{
               font-weight: 500;
           }

           .year{
                width: 100%;
                height: 50%;
                border-bottom: 1px solid var(--app-background-color-dark);
           }

           .quarter{
                height: 50%;
                width: calc(24px * 3);
           }

           .quarter:not(:last-child){
                border-right: 1px solid var(--app-background-color-dark);
           }

           .btn-left, .btn-right{
                display:flex;
                flex-flow: row wrap;
                align-items: center;
                height: 48px;
                width: 10%;
                flex-grow: 1;
           }

           .btn-left{
               justify-content: flex-end;
           }

           .btn-right{
                justify-content: flex-start;
           }
        </style>

        <paper-dialog id="medication-plan" always-on-top="true" no-cancel-on-outside-click="true">

            <h2 class="modal-title">[[localize('med_plan','Medication plan',language)]]

                <paper-tabs selected="{{selectedTab}}">
                    <paper-tab>History</paper-tab>
                    <paper-tab>Present</paper-tab>
                    <paper-tab>Patient</paper-tab>
                </paper-tabs>
            </h2>
            

            <template is="dom-if" if="{{_isEqual(selectedTab,0)}}">
                <div class="history">
                    <div class="timeline">
                        <div class="timeline-header">
                            <div class="btn-left">
                                <paper-icon-button icon="arrow-back"></paper-icon-button>
                            </div>
                            <div class="years-container">
                                <div class="year-block">
                                    <div class="year">2015</div>
                                    <div class="quarter">Q1</div>
                                    <div class="quarter">Q2</div>
                                    <div class="quarter">Q3</div>
                                    <div class="quarter">Q4</div>
                                </div>
                                <div class="year-block">
                                    <div class="year">2016</div>
                                    <div class="quarter">Q1</div>
                                    <div class="quarter">Q2</div>
                                    <div class="quarter">Q3</div>
                                    <div class="quarter">Q4</div>
                                </div>
                                <div class="year-block">
                                    <div class="year">2017</div>
                                    <div class="quarter">Q1</div>
                                    <div class="quarter">Q2</div>
                                    <div class="quarter">Q3</div>
                                    <div class="quarter">Q4</div>
                                </div>
                                <div class="year-block current">
                                    <div class="year">2018</div>
                                    <div class="quarter">Q1</div>
                                    <div class="quarter">Q2</div>
                                    <div class="quarter">Q3</div>
                                    <div class="quarter">Q4</div>
                                </div>
                                <div class="year-block">
                                    <div class="year">2019</div>
                                    <div class="quarter">Q1</div>
                                    <div class="quarter">Q2</div>
                                    <div class="quarter">Q3</div>
                                    <div class="quarter">Q4</div>
                                </div>
                                <div class="year-block">
                                    <div class="year">2020</div>
                                    <div class="quarter">Q1</div>
                                    <div class="quarter">Q2</div>
                                    <div class="quarter">Q3</div>
                                    <div class="quarter">Q4</div>
                                </div>
                                <div class="year-block">
                                    <div class="year">2021</div>
                                    <div class="quarter">Q1</div>
                                    <div class="quarter">Q2</div>
                                    <div class="quarter">Q3</div>
                                    <div class="quarter">Q4</div>
                                </div>
                            </div>
                            <div class="btn-right">
                                <paper-icon-button icon="arrow-forward"></paper-icon-button>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </template>
           
            <template is="dom-if" if="{{_isEqual(selectedTab,1)}}">
                <div class="present">
                    <div class="table">
                            <div class="tr th">
                                <div class="td">
                                        
                                </div>
                                <div class="td"
                                style="flex-grow: 3;">
                                    
                                </div>
                                <div class="td" style="flex-grow: 2;">
                                    
                                </div>
                                <div class="td span-3" style="flex-grow: 3;">
                                    Breakfast
                                </div>
                                <div class="td span-3" style="flex-grow: 3;">
                                    Lunch
                                </div>
                                <div class="td span-3" style="flex-grow: 3;">
                                    Dinner
                                </div>
                                <div class="td"  style="flex-grow: 2;">
                                    
                                </div>
                                <div class="td"  style="flex-grow: 4;">
                                    
                                </div>
                            </div>
                            <div class="tr th">
                                <div class="td">
                                        
                                </div>
                                <div class="td td--medicine"
                                style="flex-grow: 3; justify-content: flex-start">
                                    Medicine
                                </div>
                                <div class="td" style="flex-grow: 2;">
                                    Frequency
                                </div>
                                <div class="td bf-bef">
                                    Before
                                </div>
                                <div class="td bf-dur">
                                    During
                                </div>
                                <div class="td bf-aft">
                                    After
                                </div>
                                <div class="td lu-bef">
                                    Before
                                </div>
                                <div class="td lu-dur">
                                    During
                                </div>
                                <div class="td lu-aft">
                                    After
                                </div>
                                <div class="td di-bef">
                                    Before
                                </div>
                                <div class="td di-dur">
                                    During
                                </div>
                                <div class="td di-aft">
                                    After
                                </div>
                                <div class="td"  style="flex-grow: 2;">
                                    End Date
                                </div>
                                <div class="td td-comments"  style="flex-grow: 4; justify-content: space-between;">
                                    Comments
                                    <paper-icon-button class="add-period-btn" on-tap="" icon="add-circle"></paper-icon-button>
                                </div>
                            </div>
                            <!-- END HEADER -->
                            <!-- START BODY -->
                            <div class="tr category">
                                <div class="td"></div>
                                <div class="td td--category" style="flex-grow: 3;">
                                    <iron-icon icon="history"></iron-icon><b>Anti-hypertenseurs</b>
                                </div>
                                <div class="td" style="flex-grow: 2;"></div>
                                <div class="td" ></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"  style="flex-grow: 2;"></div>
                                <div class="td"  style="flex-grow: 4;"></div>
                            </div>
                            <div class="tr ICD-10--XII-bg">
                                <div class="td reimbursed">
                                    <iron-icon id="reimbursedStatus" icon="icons:euro-symbol" class="ok"></iron-icon>
                                    <paper-tooltip for="reimbursedStatus" >reimbursed</paper-tooltip>
                                </div>
                                <div class="td td--medicine" style="flex-grow: 3;">
                                    <span>Amlor 200mg</span>
                                </div>
                                <div class="td" style="flex-grow: 2;"><span>2x/d</span></div>
                                <div class="td bf-bef">1</div>
                                <div class="td bf-dur"></div>
                                <div class="td bf-aft"></div>
                                <div class="td lu-bef"></div>
                                <div class="td lu-dur"></div>
                                <div class="td lu-aft"></div>
                                <div class="td di-bef">1</div>
                                <div class="td di-dur"></div>
                                <div class="td di-aft"></div>
                                <div class="td" style="flex-grow: 2;">10/02/2019</div>
                                <div class="td td--comments" style="flex-grow: 4;"></div>
                            </div>
                            <div class="tr ICD-10--XII-bg old">
                                <div class="td reimbursed">
                                    <iron-icon id="reimbursedStatus" icon="icons:euro-symbol" class="ok"></iron-icon>
                                    <paper-tooltip for="reimbursedStatus" >reimbursed</paper-tooltip>
                                </div>
                                <div class="td td--medicine" style="flex-grow: 3;">
                                    <span>Selectol 500mg</span>
                                </div>
                                <div class="td" style="flex-grow: 2;"><span>2x/d</span></div>
                                <div class="td bf-bef"></div>
                                <div class="td bf-dur"></div>
                                <div class="td bf-aft">1</div>
                                <div class="td lu-bef"></div>
                                <div class="td lu-dur"></div>
                                <div class="td lu-aft">1</div>
                                <div class="td di-bef"></div>
                                <div class="td di-dur"></div>
                                <div class="td di-aft"></div>
                                <div class="td" style="flex-grow: 2;">30/10/2018</div>
                                <div class="td td--comments" style="flex-grow: 4;"></div>
                            </div>
                            <div class="tr category">
                                <div class="td"></div>
                                <div class="td td--category" style="flex-grow: 3;">
                                    <iron-icon icon="history"></iron-icon><b>Anti-douleurs</b>
                                </div>
                                <div class="td" style="flex-grow: 2;"></div>
                                <div class="td" ></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"></div>
                                <div class="td"  style="flex-grow: 2;"></div>
                                <div class="td td--comments"  style="flex-grow: 4;"></div>
                            </div>
                            <div class="tr ICD-10--XI-bg">
                                <div class="td reimbursed">
                                    <iron-icon icon="icons:euro-symbol"  class="nok"></iron-icon>
                                </div>
                                <div class="td td--medicine" style="flex-grow: 3;">
                                    <span>Paracétamol Téva 200mg </span>
                                </div>
                                <div class="td" style="flex-grow: 2;">
                                    <span>2x/d</span>
                                </div>
                                <div class="td bf-bef"></div>
                                <div class="td bf-dur"></div>
                                <div class="td bf-aft"></div>
                                <div class="td lu-bef">1</div>
                                <div class="td lu-dur"></div>
                                <div class="td lu-aft"></div>
                                <div class="td di-bef">1</div>
                                <div class="td di-dur"></div>
                                <div class="td di-aft"></div>
                                <div class="td"  style="flex-grow: 2;"></div>
                                <div class="td td--comments"  style="flex-grow: 4;"> Take with a glass of milk</div>
                            </div>
                            <div class="tr ICD-10--XI-bg">
                                    <div class="td reimbursed">
                                        <iron-icon icon="icons:euro-symbol" class="pending"></iron-icon>
                                    </div>
                                    <div class="td td--medicine"
                                        style="flex-grow: 3;">
                                        <span>Claradol Codéine 20mg </span>
                                    </div>
                                    <div class="td"
                                        style="justify-content: center; flex-grow: 2;">
                                        <span>3x/d</span>
                                    </div>
                                    <div class="td bf-bef"></div>
                                    <div class="td bf-dur">1</div>
                                    <div class="td bf-aft"></div>
                                    <div class="td lu-bef">1</div>
                                    <div class="td lu-dur"></div>
                                    <div class="td lu-aft"></div>
                                    <div class="td di-bef"></div>
                                    <div class="td di-dur">1</div>
                                    <div class="td di-aft"></div>
                                    <div class="td"  style="flex-grow: 2;"></div>
                                    <div class="td td--comments"  style="flex-grow: 4;"> Take with a glass of brandy</div>
                                </div>
                              </div>
                              <!-- END BODY -->
                              <!-- END TABLE -->
                          </div>
                          
                </div>
            </template>

            <template is="dom-if" if="{{_isEqual(selectedTab,2)}}">
                <div class="patient">
                    <div class="general-infos">
                        <div class="infos-block">
                            <div class="infos--name"><span>GP</span>Dr. FirstName LastName</div>
                            <div class="infos--address"><span>Address</span>50 street StreetName</div>
                        </div>

                        <div class="infos-block">
                            <div class="infos--name"><span>Pharmacist</span>FirstName LastName</div>
                            <div class="infos--address"><span>Address</span>250 street StreetName</div>
                        </div>
                    </div>
                    <div id="breakfast" class="table-container">
                        <div class="header">
                            <iron-icon icon="icure-svg-icons:breakfast"></iron-icon>
                            <h3>breakfast</h3>
                        </div>
                        <div class="table-header">
                            <div class="col col--med">Medicine</div>
                            <div class="col col--photo">Photo</div>
                            <div class="col col--ed">End Date</div>
                            <div class="col col--freq">Frequency</div>
                            <div class="col col--bef">Before</div>
                            <div class="col col--dur">During</div>
                            <div class="col col--aft">After</div>
                            <div class="col col--com">Comments</div>
                        </div>
                        <div class="table-body">
                            <div class="table-row">
                                <div class="col col--med"><span class="med--name">Burinex Leo</span><span class="med--comp">comp 30x 1mg</span></div>
                                <div class="col col--photo">Photo</div>
                                <div class="col col--ed">30/03/2018</div>
                                <div class="col col--freq">Everyday</div>
                                <div class="col col--bef"><span class="dur-pill">1</span></div>
                                <div class="col col--dur"></div>
                                <div class="col col--aft"></div>
                                <div class="col col--com">Drink with a glass of milk</div>
                            </div>
                            <div class="table-row">
                                <div class="col col--med"><span class="med--name">Omeprazole Mylan</span><span class="med--comp">caps 100 x 2mg</span></div>
                                <div class="col col--photo">Photo</div>
                                <div class="col col--ed"></div>
                                <div class="col col--freq">Once a week</div>
                                <div class="col col--bef"></div>
                                <div class="col col--dur"><span class="dur-pill">1</span></div>
                                <div class="col col--aft"></div>
                                <div class="col col--com"></div>
                            </div>
                        </div>
                    </div>
                    <div id="lunch" class="table-container">
                        <div class="header">
                            <iron-icon icon="icure-svg-icons:lunch"></iron-icon>
                            <h3>Lunch</h3>
                        </div>
                        <div class="table-header">
                            <div class="col col--med">Medicine</div>
                            <div class="col col--photo">Photo</div>
                            <div class="col col--ed">End Date</div>
                            <div class="col col--freq">Frequency</div>
                            <div class="col col--bef">Before</div>
                            <div class="col col--dur">During</div>
                            <div class="col col--aft">After</div>
                            <div class="col col--com">Comments</div>
                        </div>
                        <div class="table-body">
                            <div class="table-row">
                                <div class="col col--med"><span class="med--name">Burinex Leo</span><span class="med--comp">comp 30x 1mg</span></div>
                                <div class="col col--photo">Photo</div>
                                <div class="col col--ed">30/03/2018</div>
                                <div class="col col--freq">Everyday</div>
                                <div class="col col--bef"><span class="dur-pill">1</span></div>
                                <div class="col col--dur"></div>
                                <div class="col col--aft"></div>
                                <div class="col col--com">Drink with a glass of milk</div>
                            </div>
                            <div class="table-row">
                                <div class="col col--med"><span class="med--name">Omeprazole Mylan</span><span class="med--comp">caps 100 x 2mg</span></div>
                                <div class="col col--photo">Photo</div>
                                <div class="col col--ed"></div>
                                <div class="col col--freq">Once a week</div>
                                <div class="col col--bef"></div>
                                <div class="col col--dur"><span class="dur-pill">1</span></div>
                                <div class="col col--aft"></div>
                                <div class="col col--com"></div>
                            </div>
                        </div>
                    </div>
                    <div id="dinner" class="table-container">
                        <div class="header">
                            <iron-icon icon="icure-svg-icons:dinner"></iron-icon>
                            <h3>Dinner</h3>
                        </div>
                        <div class="table-header">
                            <div class="col col--med">Medicine</div>
                            <div class="col col--photo">Photo</div>
                            <div class="col col--ed">End Date</div>
                            <div class="col col--freq">Frequency</div>
                            <div class="col col--bef">Before</div>
                            <div class="col col--dur">During</div>
                            <div class="col col--aft">After</div>
                            <div class="col col--com">Comments</div>
                        </div>
                        <div class="table-body">
                            <div class="table-row">
                                <div class="col col--med"><span class="med--name">Burinex Leo</span><span class="med--comp">comp 30x 1mg</span></div>
                                <div class="col col--photo">Photo</div>
                                <div class="col col--ed">30/03/2018</div>
                                <div class="col col--freq">Everyday</div>
                                <div class="col col--bef"><span class="dur-pill">1</span></div>
                                <div class="col col--dur"></div>
                                <div class="col col--aft"></div>
                                <div class="col col--com">Drink with a glass of milk</div>
                            </div>
                            <div class="table-row">
                                <div class="col col--med"><span class="med--name">Omeprazole Mylan</span><span class="med--comp">caps 100 x 2mg</span></div>
                                <div class="col col--photo">Photo</div>
                                <div class="col col--ed"></div>
                                <div class="col col--freq">Once a week</div>
                                <div class="col col--bef"></div>
                                <div class="col col--dur"><span class="dur-pill">1</span></div>
                                <div class="col col--aft"></div>
                                <div class="col col--com"></div>
                            </div>
                        </div>
                    </div>
                    <div id="beforeBed" class="table-container">
                        <div class="header">
                            <iron-icon icon="icure-svg-icons:bed"></iron-icon>
                            <h3>Before Bed</h3>
                        </div>
                        <div class="table-header">
                            <div class="col col--med">Medicine</div>
                            <div class="col col--photo">Photo</div>
                            <div class="col col--ed">End Date</div>
                            <div class="col col--freq">Frequency</div>
                            <div class="col col--bef">Before</div>
                            <div class="col col--dur">During</div>
                            <div class="col col--aft">After</div>
                            <div class="col col--com">Comments</div>
                        </div>
                        <div class="table-body">
                            <div class="table-row">
                                <div class="col col--med"><span class="med--name">Burinex Leo</span><span class="med--comp">comp 30x 1mg</span></div>
                                <div class="col col--photo">Photo</div>
                                <div class="col col--ed">30/03/2018</div>
                                <div class="col col--freq">Everyday</div>
                                <div class="col col--bef"><span class="dur-pill">1</span></div>
                                <div class="col col--dur"></div>
                                <div class="col col--aft"></div>
                                <div class="col col--com">Drink with a glass of milk</div>
                            </div>
                            <div class="table-row">
                                <div class="col col--med"><span class="med--name">Omeprazole Mylan</span><span class="med--comp">caps 100 x 2mg</span></div>
                                <div class="col col--photo">Photo</div>
                                <div class="col col--ed"></div>
                                <div class="col col--freq">Once a week</div>
                                <div class="col col--bef"></div>
                                <div class="col col--dur"><span class="dur-pill">1</span></div>
                                <div class="col col--aft"></div>
                                <div class="col col--com"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            
            
           
           
            
            <div class="buttons">
                <paper-button dialog-confirm autofocus on-tap="cancel" class="modal-button modal-button--cancel">Close</paper-button>
                
                <paper-button dialog-confirm autofocus on-tap="" class="modal-button modal-button--save">Add medication</paper-button>
                
            </div>
        </paper-dialog>
    </template>
    <script>

        import _ from 'lodash/lodash'

        class MedicationPlanDialog extends Polymer.TkLocalizerMixin(Polymer.Element) {
            static get is() {
                return 'medication-plan-dialog'
            }

            static get properties() {
                return {
                    api: {
                        type: Object
                    },
                    selectedMedicationContentWithId: {
                        type: Object,
                        value: null,
                        notify: true
                    },
                    selectedTab: {
                        type: Number,
                        value: 0
                    }
                }
            }

            constructor() {
                super()
            }

            ready() {
                super.ready()
                this.addEventListener('iron-resize', () => this._setInitialScroll());
            }

            attached() {
                super.attached();
                this.async(this.notifyResize, 1);
            }

            setSelectedTab(e) {
                this.set('selectedTab',e)
            }

            _setInitialScroll(){
                const current = this.shadowRoot.querySelector('.current')
                const container = this.shadowRoot.querySelector('.years-container')
                console.log(current.offsetLeft)
                const currentLeftPos = current.offsetLeft
                container.scrollLeft = currentLeftPos
            }

            _isEqual(a,b) {
                console.log(a+' ?= '+b)
                return (a === b)
            }

            open(medicationPlan, selectedMedicationContentWithId) {
                this.$['medication-plan'].open()
            }

            _localize(s) {
                return this.api.contact().medication().localize(s, this.language)
            }

            cancel() {
                this.close()
            }

            saveAndClose() {
                this.save() // instant save
                this.close()
            }

            close() {
                this.set("selectedMedicationContentWithId", null)
            }

            _closeAndNew() {
                const target = this.parentNode
                this._valueChanged() // instant save
                this.close()
                // this.parentNode.dispatchEvent(new CustomEvent('newMedicFromChild',{}) )
            }

            save() {
                this._valueChanged()
            }


        }

        customElements.define(MedicationPlanDialog.is, MedicationPlanDialog)
    </script>
</dom-module>
