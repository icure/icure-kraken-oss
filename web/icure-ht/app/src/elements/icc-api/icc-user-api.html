
	<link rel="import" href="../../../bower_components/polymer/polymer.html">
	<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

	<dom-module id="icc-user-api">
		<template>
    		<style>
	    	</style>

				<iron-ajax id="assignHealthcareParty" method="PUT" headers="[[headers]]" url="/user/current/hcparty/{healthcarePartyId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="createUser" method="POST" headers="[[headers]]" url="/user" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="deleteUser" method="DELETE" headers="[[headers]]" url="/user/{userId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getCurrentUser" method="GET" headers="[[headers]]" url="/user/current" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getUser" method="GET" headers="[[headers]]" url="/user/{userId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getUserByEmail" method="GET" headers="[[headers]]" url="/user/byEmail/{email}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="listUsers" method="GET" headers="[[headers]]" url="/user" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="modifyProperties" method="PUT" headers="[[headers]]" url="/user/{userId}/properties" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="modifyUser" method="PUT" headers="[[headers]]" url="/user" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
		</template>
	</dom-module>

	<script>
		(function () {
			Polymer({
				is: 'icc-user-api',
				properties: {
					headers: {
						type: Object,
						value: {"Content-Type": "application/json"}
					},
					host: {
						type: String
					}
				},
				behaviors: [],
				assignHealthcareParty: function (healthcarePartyId) {
					var xhr = this.$.assignHealthcareParty

					xhr.url = this.host+"/user/current/hcparty/{healthcarePartyId}".replace("{healthcarePartyId}", healthcarePartyId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				createUser: function (body) {
					var xhr = this.$.createUser
					xhr.body = body
					xhr.url = this.host+"/user" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				deleteUser: function (userId) {
					var xhr = this.$.deleteUser

					xhr.url = this.host+"/user/{userId}".replace("{userId}", userId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getCurrentUser: function () {
					var xhr = this.$.getCurrentUser

					xhr.url = this.host+"/user/current" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getUser: function (userId) {
					var xhr = this.$.getUser

					xhr.url = this.host+"/user/{userId}".replace("{userId}", userId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getUserByEmail: function (email) {
					var xhr = this.$.getUserByEmail

					xhr.url = this.host+"/user/byEmail/{email}".replace("{email}", email) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				listUsers: function (startKey, startDocumentId, limit) {
					var xhr = this.$.listUsers

					xhr.url = this.host+"/user" + "?ts=" + (new Date).getTime()  + (startKey ? "&startKey=" + startKey : "") + (startDocumentId ? "&startDocumentId=" + startDocumentId : "") + (limit ? "&limit=" + limit : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				modifyProperties: function (userId, body) {
					var xhr = this.$.modifyProperties
					xhr.body = body
					xhr.url = this.host+"/user/{userId}/properties".replace("{userId}", userId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				modifyUser: function (body) {
					var xhr = this.$.modifyUser
					xhr.body = body
					xhr.url = this.host+"/user" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				handleError: function (e) {
					if (e.detail.request.status === 401) this.fire('auth-failed')
					else this.fire('api-error', e)
				}
			});
		})();
	</script>

@end
