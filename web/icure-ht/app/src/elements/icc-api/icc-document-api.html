
	<link rel="import" href="../../../bower_components/polymer/polymer.html">
	<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

	<dom-module id="icc-document-api">
		<template>
    		<style>
	    	</style>

				<iron-ajax id="createDocument" method="POST" headers="[[headers]]" url="/document" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="deleteAttachment" method="DELETE" headers="[[headers]]" url="/document/{documentId}/attachment" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="deleteDocument" method="DELETE" headers="[[headers]]" url="/document/{documentIds}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="findByHCPartyMessageSecretFKeys" method="GET" headers="[[headers]]" url="/document/byHcPartySecretForeignKeys" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getAttachment" method="GET" headers="[[headers]]" url="/document/{documentId}/attachment/{attachmentId}" handle-as="arraybuffer"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getDocument" method="GET" headers="[[headers]]" url="/document/{documentId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="modifyDocument" method="PUT" headers="[[headers]]" url="/document" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="sendByEmail" method="POST" headers="[[headers]]" url="/document/mailto/{recipients}/from/{sender}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="setAttachment" method="PUT" headers="[[headers]]" url="/document/{documentId}/attachment" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
		</template>
	</dom-module>

	<script>
		(function () {
			Polymer({
				is: 'icc-document-api',
				properties: {
					headers: {
						type: Object,
						value: {"Content-Type": "application/json"}
					},
					host: {
						type: String
					}
				},
				behaviors: [],
				createDocument: function (body) {
					var xhr = this.$.createDocument
					xhr.body = body
					xhr.url = this.host+"/document" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				deleteAttachment: function (documentId) {
					var xhr = this.$.deleteAttachment

					xhr.url = this.host+"/document/{documentId}/attachment".replace("{documentId}", documentId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				deleteDocument: function (documentIds) {
					var xhr = this.$.deleteDocument

					xhr.url = this.host+"/document/{documentIds}".replace("{documentIds}", documentIds) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				findByHCPartyMessageSecretFKeys: function (hcPartyId, secretFKeys) {
					var xhr = this.$.findByHCPartyMessageSecretFKeys

					xhr.url = this.host+"/document/byHcPartySecretForeignKeys" + "?ts=" + (new Date).getTime()  + (hcPartyId ? "&hcPartyId=" + hcPartyId : "") + (secretFKeys ? "&secretFKeys=" + secretFKeys : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getAttachment: function (documentId, attachmentId) {
					var xhr = this.$.getAttachment

					xhr.url = this.host+"/document/{documentId}/attachment/{attachmentId}".replace("{documentId}", documentId).replace("{attachmentId}", attachmentId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getDocument: function (documentId) {
					var xhr = this.$.getDocument

					xhr.url = this.host+"/document/{documentId}".replace("{documentId}", documentId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				modifyDocument: function (body) {
					var xhr = this.$.modifyDocument
					xhr.body = body
					xhr.url = this.host+"/document" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				sendByEmail: function (sender, recipients, bccs, body) {
					var xhr = this.$.sendByEmail
					xhr.body = body
					xhr.url = this.host+"/document/mailto/{recipients}/from/{sender}".replace("{sender}", sender).replace("{recipients}", recipients) + "?ts=" + (new Date).getTime()  + (bccs ? "&bccs=" + bccs : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				setAttachment: function (documentId, body) {
					var xhr = this.$.setAttachment
					xhr.body = body
					xhr.url = this.host+"/document/{documentId}/attachment".replace("{documentId}", documentId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				handleError: function (e) {
					if (e.detail.request.status === 401) this.fire('auth-failed')
					else this.fire('api-error', e)
				}
			});
		})();
	</script>

@end
