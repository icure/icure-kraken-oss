
	<link rel="import" href="../../../bower_components/polymer/polymer.html">
	<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

	<dom-module id="icc-replication-api">
		<template>
    		<style>
	    	</style>

				<iron-ajax id="createGroupReplication" method="POST" headers="[[headers]]" url="/replication/group/{replicationHost}/{groupId}/{password}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="createReplication" method="POST" headers="[[headers]]" url="/replication" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="createStandardReplication" method="POST" headers="[[headers]]" url="/replication/standard/{replicationHost}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="createTemplateReplication" method="POST" headers="[[headers]]" url="/replication/template/{replicationHost}/{language}/{specialtyCode}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="deleteReplication" method="DELETE" headers="[[headers]]" url="/replication/{replicationId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getReplication" method="GET" headers="[[headers]]" url="/replication/{replicationId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="listReplications" method="GET" headers="[[headers]]" url="/replication" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="modifyReplication" method="PUT" headers="[[headers]]" url="/replication" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
		</template>
	</dom-module>

	<script>
		(function () {
			Polymer({
				is: 'icc-replication-api',
				properties: {
					headers: {
						type: Object,
						value: {"Content-Type": "application/json"}
					},
					host: {
						type: String
					}
				},
				behaviors: [],
				createGroupReplication: function (replicationHost, groupId, password, protocol, port) {
					var xhr = this.$.createGroupReplication

					xhr.url = this.host+"/replication/group/{replicationHost}/{groupId}/{password}".replace("{replicationHost}", replicationHost).replace("{groupId}", groupId).replace("{password}", password) + "?ts=" + (new Date).getTime()  + (protocol ? "&protocol=" + protocol : "") + (port ? "&port=" + port : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				createReplication: function (body) {
					var xhr = this.$.createReplication
					xhr.body = body
					xhr.url = this.host+"/replication" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				createStandardReplication: function (replicationHost) {
					var xhr = this.$.createStandardReplication

					xhr.url = this.host+"/replication/standard/{replicationHost}".replace("{replicationHost}", replicationHost) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				createTemplateReplication: function (replicationHost, language, specialtyCode, protocol, port) {
					var xhr = this.$.createTemplateReplication

					xhr.url = this.host+"/replication/template/{replicationHost}/{language}/{specialtyCode}".replace("{replicationHost}", replicationHost).replace("{language}", language).replace("{specialtyCode}", specialtyCode) + "?ts=" + (new Date).getTime()  + (protocol ? "&protocol=" + protocol : "") + (port ? "&port=" + port : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				deleteReplication: function (replicationId) {
					var xhr = this.$.deleteReplication

					xhr.url = this.host+"/replication/{replicationId}".replace("{replicationId}", replicationId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getReplication: function (replicationId) {
					var xhr = this.$.getReplication

					xhr.url = this.host+"/replication/{replicationId}".replace("{replicationId}", replicationId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				listReplications: function () {
					var xhr = this.$.listReplications

					xhr.url = this.host+"/replication" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				modifyReplication: function (body) {
					var xhr = this.$.modifyReplication
					xhr.body = body
					xhr.url = this.host+"/replication" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				handleError: function (e) {
					if (e.detail.request.status === 401) this.fire('auth-failed')
					else this.fire('api-error', e)
				}
			});
		})();
	</script>

@end
