
	<link rel="import" href="../../../bower_components/polymer/polymer.html">
	<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

	<dom-module id="icc-bedrugs-api">
		<template>
    		<style>
	    	</style>

				<iron-ajax id="fullTextSearch" method="GET" headers="[[headers]]" url="/be_drugs/mpp/find/fullText/{searchString}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getCheapAlternativesBasedOnAtc" method="GET" headers="[[headers]]" url="/be_drugs/atc/{medecinePackageId}/{lang}/cheapmpps" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getCheapAlternativesBasedOnInn" method="GET" headers="[[headers]]" url="/be_drugs/inn/{innClusterId}/{lang}/cheapmpps" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getChildrenDocs" method="GET" headers="[[headers]]" url="/be_drugs/doc/childrenof/{docId}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getChildrenMps" method="GET" headers="[[headers]]" url="/be_drugs/mp/childrenof/{docId}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getDocOfMp" method="GET" headers="[[headers]]" url="/be_drugs/doc/formp/{medecineId}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getDocPreview" method="GET" headers="[[headers]]" url="/be_drugs/doc/{docId}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getExtentedMpInfosWithPackage" method="GET" headers="[[headers]]" url="/be_drugs/mp/xt/{medecinePackageId}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getFullMpInfosWithPackage" method="GET" headers="[[headers]]" url="/be_drugs/mp/full/{medecinePackageId}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getInnClusters" method="GET" headers="[[headers]]" url="/be_drugs/inn/find/{searchString}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getInteractions" method="GET" headers="[[headers]]" url="/be_drugs/mpp/{medecinePackageId}/{lang}/interactwith/{otherCnks}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getMedecinePackages" method="GET" headers="[[headers]]" url="/be_drugs/mpp/find/{searchString}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getMedecinePackagesFromIngredients" method="GET" headers="[[headers]]" url="/be_drugs/mpp/find/byIngredients/{searchString}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getMpFromMpp" method="GET" headers="[[headers]]" url="/be_drugs/mpp/{medecinePackageId}/{lang}/mp" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getMppInfos" method="GET" headers="[[headers]]" url="/be_drugs/mpp/{medecinePackageId}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getParentDoc" method="GET" headers="[[headers]]" url="/be_drugs/doc/parentof/{docId}/{lang}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getRootDocs" method="GET" headers="[[headers]]" url="/be_drugs/doc" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
		</template>
	</dom-module>

	<script>
		(function () {
			Polymer({
				is: 'icc-bedrugs-api',
				properties: {
					headers: {
						type: Object,
						value: {"Content-Type": "application/json"}
					},
					host: {
						type: String
					}
				},
				behaviors: [],
				fullTextSearch: function (searchString, lang, classes, types, first, count) {
					var xhr = this.$.fullTextSearch

					xhr.url = this.host+"/be_drugs/mpp/find/fullText/{searchString}/{lang}".replace("{searchString}", searchString).replace("{lang}", lang) + "?ts=" + (new Date).getTime()  + (classes ? "&classes=" + classes : "") + (types ? "&types=" + types : "") + (first ? "&first=" + first : "") + (count ? "&count=" + count : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getCheapAlternativesBasedOnAtc: function (medecinePackageId, lang) {
					var xhr = this.$.getCheapAlternativesBasedOnAtc

					xhr.url = this.host+"/be_drugs/atc/{medecinePackageId}/{lang}/cheapmpps".replace("{medecinePackageId}", medecinePackageId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getCheapAlternativesBasedOnInn: function (innClusterId, lang) {
					var xhr = this.$.getCheapAlternativesBasedOnInn

					xhr.url = this.host+"/be_drugs/inn/{innClusterId}/{lang}/cheapmpps".replace("{innClusterId}", innClusterId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getChildrenDocs: function (docId, lang) {
					var xhr = this.$.getChildrenDocs

					xhr.url = this.host+"/be_drugs/doc/childrenof/{docId}/{lang}".replace("{docId}", docId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getChildrenMps: function (docId, lang) {
					var xhr = this.$.getChildrenMps

					xhr.url = this.host+"/be_drugs/mp/childrenof/{docId}/{lang}".replace("{docId}", docId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getDocOfMp: function (medecineId, lang) {
					var xhr = this.$.getDocOfMp

					xhr.url = this.host+"/be_drugs/doc/formp/{medecineId}/{lang}".replace("{medecineId}", medecineId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getDocPreview: function (docId, lang) {
					var xhr = this.$.getDocPreview

					xhr.url = this.host+"/be_drugs/doc/{docId}/{lang}".replace("{docId}", docId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getExtentedMpInfosWithPackage: function (medecinePackageId, lang) {
					var xhr = this.$.getExtentedMpInfosWithPackage

					xhr.url = this.host+"/be_drugs/mp/xt/{medecinePackageId}/{lang}".replace("{medecinePackageId}", medecinePackageId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getFullMpInfosWithPackage: function (medecinePackageId, lang) {
					var xhr = this.$.getFullMpInfosWithPackage

					xhr.url = this.host+"/be_drugs/mp/full/{medecinePackageId}/{lang}".replace("{medecinePackageId}", medecinePackageId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getInnClusters: function (searchString, lang, types, first, count) {
					var xhr = this.$.getInnClusters

					xhr.url = this.host+"/be_drugs/inn/find/{searchString}/{lang}".replace("{searchString}", searchString).replace("{lang}", lang) + "?ts=" + (new Date).getTime()  + (types ? "&types=" + types : "") + (first ? "&first=" + first : "") + (count ? "&count=" + count : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getInteractions: function (medecinePackageId, lang, otherCnks) {
					var xhr = this.$.getInteractions

					xhr.url = this.host+"/be_drugs/mpp/{medecinePackageId}/{lang}/interactwith/{otherCnks}".replace("{medecinePackageId}", medecinePackageId).replace("{lang}", lang).replace("{otherCnks}", otherCnks) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getMedecinePackages: function (searchString, lang, types, first, count) {
					var xhr = this.$.getMedecinePackages

					xhr.url = this.host+"/be_drugs/mpp/find/{searchString}/{lang}".replace("{searchString}", searchString).replace("{lang}", lang) + "?ts=" + (new Date).getTime()  + (types ? "&types=" + types : "") + (first ? "&first=" + first : "") + (count ? "&count=" + count : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getMedecinePackagesFromIngredients: function (searchString, lang, types, first, count) {
					var xhr = this.$.getMedecinePackagesFromIngredients

					xhr.url = this.host+"/be_drugs/mpp/find/byIngredients/{searchString}/{lang}".replace("{searchString}", searchString).replace("{lang}", lang) + "?ts=" + (new Date).getTime()  + (types ? "&types=" + types : "") + (first ? "&first=" + first : "") + (count ? "&count=" + count : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getMpFromMpp: function (medecinePackageId, lang) {
					var xhr = this.$.getMpFromMpp

					xhr.url = this.host+"/be_drugs/mpp/{medecinePackageId}/{lang}/mp".replace("{medecinePackageId}", medecinePackageId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getMppInfos: function (medecinePackageId, lang) {
					var xhr = this.$.getMppInfos

					xhr.url = this.host+"/be_drugs/mpp/{medecinePackageId}/{lang}".replace("{medecinePackageId}", medecinePackageId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getParentDoc: function (docId, lang) {
					var xhr = this.$.getParentDoc

					xhr.url = this.host+"/be_drugs/doc/parentof/{docId}/{lang}".replace("{docId}", docId).replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getRootDocs: function (lang) {
					var xhr = this.$.getRootDocs

					xhr.url = this.host+"/be_drugs/doc".replace("{lang}", lang) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				handleError: function (e) {
					if (e.detail.request.status === 401) this.fire('auth-failed')
					else this.fire('api-error', e)
				}
			});
		})();
	</script>

@end
