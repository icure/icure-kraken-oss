
	<link rel="import" href="../../../bower_components/polymer/polymer.html">
	<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

	<dom-module id="icc-bechapter-api">
		<template>
    		<style>
	    	</style>

				<iron-ajax id="agreementDetailsFromDocument" method="GET" headers="[[headers]]" url="/be_chapter4/paragraphs/{documentId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="agreementRequestsConsultation" method="GET" headers="[[headers]]" url="/be_chapter4/consult/{token}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="cancelAgreement" method="PUT" headers="[[headers]]" url="/be_chapter4/cancel/{token}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="closeAgreement" method="PUT" headers="[[headers]]" url="/be_chapter4/close/{token}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="findParagraphs" method="GET" headers="[[headers]]" url="/be_chapter4" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="findParagraphsWithCnk" method="GET" headers="[[headers]]" url="/be_chapter4/paragraphs/{cnk}/{language}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getAddedDocuments" method="GET" headers="[[headers]]" url="/be_chapter4/documents" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getAppendixPrototype" method="GET" headers="[[headers]]" url="/be_chapter4/appendix/prototype" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="requestAgreementExtension" method="POST" headers="[[headers]]" url="/be_chapter4/extension/{token}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="requestComplementaryAppendix" method="POST" headers="[[headers]]" url="/be_chapter4/complementary/{token}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="requestNewAgreement" method="POST" headers="[[headers]]" url="/be_chapter4/new/{token}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
		</template>
	</dom-module>

	<script>
		(function () {
			Polymer({
				is: 'icc-bechapter-api',
				properties: {
					headers: {
						type: Object,
						value: {"Content-Type": "application/json"}
					},
					host: {
						type: String
					}
				},
				behaviors: [],
				agreementDetailsFromDocument: function (documentId) {
					var xhr = this.$.agreementDetailsFromDocument

					xhr.url = this.host+"/be_chapter4/paragraphs/{documentId}".replace("{documentId}", documentId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				agreementRequestsConsultation: function (token, patientId, startOfAgreement, endOfAgreement, reference, paragraph, version) {
					var xhr = this.$.agreementRequestsConsultation

					xhr.url = this.host+"/be_chapter4/consult/{token}".replace("{token}", token) + "?ts=" + (new Date).getTime()  + (patientId ? "&patientId=" + patientId : "") + (startOfAgreement ? "&startOfAgreement=" + startOfAgreement : "") + (endOfAgreement ? "&endOfAgreement=" + endOfAgreement : "") + (reference ? "&reference=" + reference : "") + (paragraph ? "&paragraph=" + paragraph : "") + (version ? "&version=" + version : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				cancelAgreement: function (token, patientId, decisionReference, ioRequestReference) {
					var xhr = this.$.cancelAgreement

					xhr.url = this.host+"/be_chapter4/cancel/{token}".replace("{token}", token) + "?ts=" + (new Date).getTime()  + (patientId ? "&patientId=" + patientId : "") + (decisionReference ? "&decisionReference=" + decisionReference : "") + (ioRequestReference ? "&ioRequestReference=" + ioRequestReference : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				closeAgreement: function (token, patientId, decisionReference) {
					var xhr = this.$.closeAgreement

					xhr.url = this.host+"/be_chapter4/close/{token}".replace("{token}", token) + "?ts=" + (new Date).getTime()  + (patientId ? "&patientId=" + patientId : "") + (decisionReference ? "&decisionReference=" + decisionReference : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				findParagraphs: function (searchString, language) {
					var xhr = this.$.findParagraphs

					xhr.url = this.host+"/be_chapter4" + "?ts=" + (new Date).getTime()  + (searchString ? "&searchString=" + searchString : "") + (language ? "&language=" + language : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				findParagraphsWithCnk: function (cnk, language) {
					var xhr = this.$.findParagraphsWithCnk

					xhr.url = this.host+"/be_chapter4/paragraphs/{cnk}/{language}".replace("{cnk}", cnk).replace("{language}", language) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getAddedDocuments: function (chapterName, paragraphName) {
					var xhr = this.$.getAddedDocuments

					xhr.url = this.host+"/be_chapter4/documents" + "?ts=" + (new Date).getTime()  + (chapterName ? "&chapterName=" + chapterName : "") + (paragraphName ? "&paragraphName=" + paragraphName : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getAppendixPrototype: function (path, mimeType, verseSeq, documentSeq) {
					var xhr = this.$.getAppendixPrototype

					xhr.url = this.host+"/be_chapter4/appendix/prototype" + "?ts=" + (new Date).getTime()  + (path ? "&path=" + path : "") + (mimeType ? "&mimeType=" + mimeType : "") + (verseSeq ? "&verseSeq=" + verseSeq : "") + (documentSeq ? "&documentSeq=" + documentSeq : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				requestAgreementExtension: function (token, patientId, continuous, incomplete, startOfAgreement, endOfAgreement, reference, paragraph, verses, version, body) {
					var xhr = this.$.requestAgreementExtension
					xhr.body = body
					xhr.url = this.host+"/be_chapter4/extension/{token}".replace("{token}", token) + "?ts=" + (new Date).getTime()  + (patientId ? "&patientId=" + patientId : "") + (continuous ? "&continuous=" + continuous : "") + (incomplete ? "&incomplete=" + incomplete : "") + (startOfAgreement ? "&startOfAgreement=" + startOfAgreement : "") + (endOfAgreement ? "&endOfAgreement=" + endOfAgreement : "") + (reference ? "&reference=" + reference : "") + (paragraph ? "&paragraph=" + paragraph : "") + (verses ? "&verses=" + verses : "") + (version ? "&version=" + version : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				requestComplementaryAppendix: function (token, patientId, incomplete, decisionReference, ioRequestReference, paragraph, version, body) {
					var xhr = this.$.requestComplementaryAppendix
					xhr.body = body
					xhr.url = this.host+"/be_chapter4/complementary/{token}".replace("{token}", token) + "?ts=" + (new Date).getTime()  + (patientId ? "&patientId=" + patientId : "") + (incomplete ? "&incomplete=" + incomplete : "") + (decisionReference ? "&decisionReference=" + decisionReference : "") + (ioRequestReference ? "&ioRequestReference=" + ioRequestReference : "") + (paragraph ? "&paragraph=" + paragraph : "") + (version ? "&version=" + version : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				requestNewAgreement: function (token, body) {
					var xhr = this.$.requestNewAgreement
					xhr.body = body
					xhr.url = this.host+"/be_chapter4/new/{token}".replace("{token}", token) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				handleError: function (e) {
					if (e.detail.request.status === 401) this.fire('auth-failed')
					else this.fire('api-error', e)
				}
			});
		})();
	</script>

@end
