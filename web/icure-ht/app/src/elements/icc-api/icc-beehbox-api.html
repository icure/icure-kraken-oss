
	<link rel="import" href="../../../bower_components/polymer/polymer.html">
	<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

	<dom-module id="icc-beehbox-api">
		<template>
    		<style>
	    	</style>

				<iron-ajax id="deleteMessages" method="PUT" headers="[[headers]]" url="/be_ehbox/delete/{token}/{from}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getEmptyMessage" method="GET" headers="[[headers]]" url="/be_ehbox/template" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getFullMessage" method="GET" headers="[[headers]]" url="/be_ehbox/message/{token}/{source}/{messageId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getIdentifierTypes" method="GET" headers="[[headers]]" url="/be_ehbox/identifiers" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getInfos" method="GET" headers="[[headers]]" url="/be_ehbox/{token}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getMessagesList" method="GET" headers="[[headers]]" url="/be_ehbox/messages/{token}/{boxId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getQualityTypes" method="GET" headers="[[headers]]" url="/be_ehbox/qualities" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="moveMessages" method="PUT" headers="[[headers]]" url="/be_ehbox/move/{token}/{from}/{to}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="refreshMessages" method="PUT" headers="[[headers]]" url="/be_ehbox/refresh/{token}/{boxId}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="sendMessage" method="POST" headers="[[headers]]" url="/be_ehbox/send/{token}/{notificationMask}" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
		</template>
	</dom-module>

	<script>
		(function () {
			Polymer({
				is: 'icc-beehbox-api',
				properties: {
					headers: {
						type: Object,
						value: {"Content-Type": "application/json"}
					},
					host: {
						type: String
					}
				},
				behaviors: [],
				deleteMessages: function (token, from, body) {
					var xhr = this.$.deleteMessages
					xhr.body = body
					xhr.url = this.host+"/be_ehbox/delete/{token}/{from}".replace("{token}", token).replace("{from}", from) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getEmptyMessage: function () {
					var xhr = this.$.getEmptyMessage

					xhr.url = this.host+"/be_ehbox/template" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getFullMessage: function (token, source, messageId) {
					var xhr = this.$.getFullMessage

					xhr.url = this.host+"/be_ehbox/message/{token}/{source}/{messageId}".replace("{token}", token).replace("{source}", source).replace("{messageId}", messageId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getIdentifierTypes: function () {
					var xhr = this.$.getIdentifierTypes

					xhr.url = this.host+"/be_ehbox/identifiers" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getInfos: function (token) {
					var xhr = this.$.getInfos

					xhr.url = this.host+"/be_ehbox/{token}".replace("{token}", token) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getMessagesList: function (token, boxId) {
					var xhr = this.$.getMessagesList

					xhr.url = this.host+"/be_ehbox/messages/{token}/{boxId}".replace("{token}", token).replace("{boxId}", boxId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getQualityTypes: function () {
					var xhr = this.$.getQualityTypes

					xhr.url = this.host+"/be_ehbox/qualities" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				moveMessages: function (token, from, to, body) {
					var xhr = this.$.moveMessages
					xhr.body = body
					xhr.url = this.host+"/be_ehbox/move/{token}/{from}/{to}".replace("{token}", token).replace("{from}", from).replace("{to}", to) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				refreshMessages: function (token, boxId, limit) {
					var xhr = this.$.refreshMessages

					xhr.url = this.host+"/be_ehbox/refresh/{token}/{boxId}".replace("{token}", token).replace("{boxId}", boxId) + "?ts=" + (new Date).getTime()  + (limit ? "&limit=" + limit : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				sendMessage: function (token, notificationMask, body) {
					var xhr = this.$.sendMessage
					xhr.body = body
					xhr.url = this.host+"/be_ehbox/send/{token}/{notificationMask}".replace("{token}", token).replace("{notificationMask}", notificationMask) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				handleError: function (e) {
					if (e.detail.request.status === 401) this.fire('auth-failed')
					else this.fire('api-error', e)
				}
			});
		})();
	</script>

@end
