
	<link rel="import" href="../../../bower_components/polymer/polymer.html">
	<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

	<dom-module id="icc-bekmehr-api">
		<template>
    		<style>
	    	</style>

				<iron-ajax id="dummyWsException" method="GET" headers="[[headers]]" url="/be_kmehr/dummy/wsException" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="generateSmfExport" method="POST" headers="[[headers]]" url="/be_kmehr/smf/{patientId}/export" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="generateSumehr" method="POST" headers="[[headers]]" url="/be_kmehr/sumehr/{patientId}/export" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="getSumehrContent" method="POST" headers="[[headers]]" url="/be_kmehr/sumehr/{patientId}/content" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="isSumehrValid" method="GET" headers="[[headers]]" url="/be_kmehr/sumehr/{patientId}/valid" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
				<iron-ajax id="validateSumehr" method="POST" headers="[[headers]]" url="/be_kmehr/sumehr/{patientId}/validate" handle-as="json"
									 on-error="handleError" with-credentials></iron-ajax>
		</template>
	</dom-module>

	<script>
		(function () {
			Polymer({
				is: 'icc-bekmehr-api',
				properties: {
					headers: {
						type: Object,
						value: {"Content-Type": "application/json"}
					},
					host: {
						type: String
					}
				},
				behaviors: [],
				dummyWsException: function () {
					var xhr = this.$.dummyWsException

					xhr.url = this.host+"/be_kmehr/dummy/wsException" + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				generateSmfExport: function (patientId, language, body) {
					var xhr = this.$.generateSmfExport
					xhr.body = body
					xhr.url = this.host+"/be_kmehr/smf/{patientId}/export".replace("{patientId}", patientId) + "?ts=" + (new Date).getTime()  + (language ? "&language=" + language : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				generateSumehr: function (patientId, language, body) {
					var xhr = this.$.generateSumehr
					xhr.body = body
					xhr.url = this.host+"/be_kmehr/sumehr/{patientId}/export".replace("{patientId}", patientId) + "?ts=" + (new Date).getTime()  + (language ? "&language=" + language : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				getSumehrContent: function (patientId, body) {
					var xhr = this.$.getSumehrContent
					xhr.body = body
					xhr.url = this.host+"/be_kmehr/sumehr/{patientId}/content".replace("{patientId}", patientId) + "?ts=" + (new Date).getTime()
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				isSumehrValid: function (patientId, hcPartyId, secretFKeys) {
					var xhr = this.$.isSumehrValid

					xhr.url = this.host+"/be_kmehr/sumehr/{patientId}/valid".replace("{patientId}", patientId) + "?ts=" + (new Date).getTime()  + (hcPartyId ? "&hcPartyId=" + hcPartyId : "") + (secretFKeys ? "&secretFKeys=" + secretFKeys : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				validateSumehr: function (patientId, language, body) {
					var xhr = this.$.validateSumehr
					xhr.body = body
					xhr.url = this.host+"/be_kmehr/sumehr/{patientId}/validate".replace("{patientId}", patientId) + "?ts=" + (new Date).getTime()  + (language ? "&language=" + language : "")
					return xhr.generateRequest().completes.then(function (req) {
						return req.response
					})
				},
				handleError: function (e) {
					if (e.detail.request.status === 401) this.fire('auth-failed')
					else this.fire('api-error', e)
				}
			});
		})();
	</script>

@end
