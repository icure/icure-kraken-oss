<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/vaadin-material-theme/vaadin-grid.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html">
<!--<link rel="import" href="./elements/collapse-button/collapse-button.html">-->
<link rel="import" href="./shared-styles.html">

<dom-module id="ht-msg">
  <template>

	<style include="icd-styles">
		:host {
			height: 100%;
		}

		.container {
			width: 100%;
			height: calc(100vh - 64px);
			display:grid;
			grid-template-columns: 20% 30% 50%;
			grid-template-rows: 100%;
			position: fixed;
			top: 64px;
			left: 0;
			bottom: 0;
			right: 0;
		}

		.zone {
			height: 100%;
		}


		.padding-0{
			padding:0;
		}

		.one-line-menu {
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			font-weight: 400;
			padding-left:0;
		}

		#first {
			height: calc(100% - 36px);
		}


		paper-fab {
			--paper-fab-mini: {
				height: 28px;
				width: 28px;
				padding: 4px;
			};

			margin-right: 4px;
		}

		.first-panel{
			/*width:20%;
            height:calc(100% - 64px);*/
			height:100%;
			background: var(--app-background-color-dark);
			/*position:fixed;*/
			top:64px;
			left:0;
			@apply --shadow-elevation-3dp;
			grid-column: 1 / 1;
			grid-row:1 / 1;
			z-index:3;
			overflow:hidden;
		}

		#_contacts_listbox {
			padding: 0;
		}

		paper-listbox{
			background:transparent;
			padding: 0;
		}

		paper-item{
			background:transparent;
			outline:0;
			--paper-item-selected:{

			};

			--paper-item-disabled-color:{
				color: red;
			};

			--paper-item-focused: {
				background:transparent;
			};
			--paper-item-focused-before: {
				background:transparent;
			};

		}

		paper-listbox {
			outline:0;
			--paper-listbox-selected-item: {
				color:var(--app-text-color-light);
				background:var(--app-primary-color);
			};
			--paper-listbox-disabled-color:{
				color: red;
			};
		}

		#adminFileMenu paper-item.iron-selected {
			color:var(--app-text-color-light);
			background:var(--app-primary-color);
			@apply --text-shadow;
		}

		collapse-button {
			outline:0;
			--paper-listbox-selected-item: {
				color:var(--app-text-color-light);
				background:var(--app-primary-color);
			}
		}

		collapse-button > .menu-item.iron-selected {
			@apply --padding-right-left-16;
			color:var(--app-text-color-light);
			background:var(--app-primary-color);
			@apply --text-shadow;
		}

		paper-item.opened{
			padding-top: 8px;

		}
		.opened{
			color:var(--app-text-color);
			background:var(--app-text-color-light);
			border-radius:2px 2px 0 0;
			box-shadow: 0 4px 0 0 white,
			0 -2px 0 0 white,
			0 2px 2px 0 rgba(0, 0, 0, 0.14),
			0 1px 5px 0 rgba(0, 0, 0, 0.12),
			0 3px 1px -2px rgba(0, 0, 0, 0.2);

		}

		.opened.iron-selected{
			box-shadow: 0 4px 0 0 white,
			0 -2px 0 0 var(--app-primary-color),
			0 2px 2px 0 rgba(0, 0, 0, 0.14),
			0 1px 5px 0 rgba(0, 0, 0, 0.12),
			0 3px 1px -2px rgba(0, 0, 0, 0.2);
		}

		.sublist{
			background:var(--app-light-color);
			margin:0 0 8px -30px;
			padding:0;
			padding-bottom:4px;
			border-radius:0 0 2px 2px;
			@apply --shadow-elevation-2dp;
		}

		paper-item.sublist-footer {
			height:48px;
			font-weight: normal;
		}

		.sublist-footer paper-icon-button.menu-item-icon, .list-info paper-icon-button.menu-item-icon {
			padding: 2px;
			height: 24px;
			width:24px;
			-webkit-border-radius: 12px;
			-moz-border-radius: 12px;
			border-radius: 12px;
			background:var(--app-secondary-color);
			color:var(--app-text-color);
			margin-right:8px;
		}

		paper-item.list-info {
			font-weight: lighter;
			font-style: italic;
			height:48px;
		}

		.list-title {
			font-weight: bold;
		}

		.menu-item{
			@apply --padding-right-left-16;
			height:48px;
			@apply --paper-font-button;
			text-transform: inherit;
			justify-content: space-between;
			cursor: pointer;
			@apply --transition;
		}

		.sublist .menu-item {
			font-size: 13px;
			min-height:32px;
			height:32px;
		}

		.menu-item:hover{
			/*background: var(--app-dark-color-faded);*/
			@apply --transition;
		}

		.menu-item .iron-selected{
			background:var(--app-primary-color);

		}

		.menu-item .opened{
			background:white!important;
			width:80%;
			border-radius:2px;
		}

		.menu-item-icon--selected{
			width:0;
		}

		.opened .menu-item-icon--selected{
			width: 18px;
		}

		.opened > .menu-item-icon{
			transform: scaleY(-1);
		}

		paper-item.menu-item.opened {
			@apply --padding-right-left-16;
		}

		.submenu-item{
			cursor:pointer;
		}

		.submenu-item.iron-selected{
			background:var(--app-primary-color-light);
			color:var(--app-text-color-light);
			@apply --text-shadow;
		}

		.submenu-item-icon{
			height:14px;
			width:14px;
			color:var(--app-text-color-light);
			margin-right:10px;
		}

		.add-btn-container{
			width:20%;
			position: absolute;
			bottom: 16px;
			/*display:none;*/
			display:flex;
			flex-direction: row;
			justify-content: center;
			align-items: center;
		}

		.new-ctc-btn-container {
			width:30%;
			left:20%;
			position: absolute;
			bottom: 16px;
			/*display:none;*/
			display:flex;
			flex-direction: row;
			justify-content: center;
			align-items: center;
		}

		.add-btn{
			--paper-button-ink-color: var(--app-secondary-color-dark);
			background:var(--app-secondary-color);
			color:var(--app-text-color);
			font-weight:bold;
			font-size:12px;
			height:40px;
			min-width:100px;
			@apply --shadow-elevation-2dp;
			padding: 10px 1.2em;
		}
		.patient-info-container{
			height:96px;
			@apply --padding-right-left-32;
			cursor:pointer;
		}

		.patient-info-container:hover{
			background: var(--app-dark-color-faded);
			@apply --transition;
		}

		.patient-info{
			@apply --padding-left-16;
			display:flex;
			flex-direction:column;
			align-items: flex-start;
			justify-content: center;
		}
		.patient-name{
			font-weight:700;
			line-height:14px;
		}
		.patient-birthdate{
			font-size: 13px;
		}

		.btn-close{
			position: absolute;
			left: 26px;
			top: 18px;
			background:var(--app-secondary-color);
			color:var(--app-text-color);
			height:20px;
			width:20px;
			z-index: 4;
		}

		.btn-close:hover{
			@apply --transition;
			top: 17px;
			@apply --shadow-elevation-2dp;
		}

		.patient-picture-container{
			height:60px;
			width:60px;
			border-radius:50%;
			overflow: hidden;
		}

		.patient-picture-container img{
			width:100%;
			margin:50%;
			transform: translate(-50%,-50%);
		}

		.submenus-container{
			overflow-x: auto;
			height: 100%;
			margin-bottom:16px;
		}



		[hidden] {
			display:none!important;
		}
		/* END FIRST PANEL */

		/* SECOND PANEL  */
		.second-panel{
			/*width:30%;*/
			height:100%;
			background: var(--app-background-color);
			/*position:fixed;*/
			top:64px;
			left:20%;
			@apply --shadow-elevation-2dp;
			margin:0;
			grid-column: 2 / 2;
			grid-row:1 / 1;

			z-index:2;

		}


		.fit-bottom{
			bottom:0;
			left:20%!important;
			width:30%;
			height:48px;
			z-index:4;
			@apply --padding-right-left-32;
			display:flex;
			flex-direction: row;
			justify-content: center;
			flex-wrap: nowrap;
			padding-top:8px;
		}

		.selection-toast-button{
			height:32px;
			@apply --paper-font-button;
			text-transform:lowercase;
		}

		.selection-toast-icon{
			height:16px;
			margin-right:4px;
		}

		div.extraDialogFields {
			margin-top: 0;
		}

		.contact{
			margin: 0 32px 16px;
			background: var(--app-light-color);
			color:var(--app-text-color);
			outline:0;
			padding:0;
			align-items: flex-start !important;
			@apply --shadow-elevation-2dp;
			position:relative;
		}

		.contact.iron-selected{
			background: var(--app-primary-color);
			color:var(--app-light-color);
			@apply --text-shadow;
		}
		.contact h4{
			font-size:14px;
			font-weight: 600;
			margin:0;
			-webkit-user-select: none; /* Chrome/Safari */
			-moz-user-select: none; /* Firefox */
			-ms-user-select: none; /* IE10+ */

			/* Rules below not implemented in browsers yet */
			-o-user-select: none;
			user-select: none;

		}

		.contact .contact-text-row{
			width:calc(100% - 32px);
			display: flex;
			flex-flow: row wrap;
			justify-content: flex-start;
			align-items: center;
			@apply --padding-right-left-16;
		}

		.contact:nth-of-type(1) .contact-text-row p {
			padding-right: 32px;
		}

		.contact .contact-text-row:first-child, .contact .contact-text-row:last-child{
			height:24px;
		}
		/*.contact .contact-text-row:nth-child(2){
            height:48px;
        }*/

		.contact-text-row p {
			width: 100%;
			text-overflow: ellipsis;
			overflow-x: hidden;
			white-space: nowrap;
		}

		.contact-text-date{
			justify-content: space-between!important;
			position: relative;
			top: 0;
			left: 0;
			right: 0;
			background: rgba(0,0,0,.1);
			@apply --padding-right-left-16;
			color: var(--app-text-color-disabled);
			height:24px;
		}

		.contact .label-container {
			display: flex;
			flex-flow: row nowrap;
		}

		.contact label{
			font-size:12px;
			font-weight: 400;
			margin:0;
			display: block;

			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;

			-webkit-user-select: none; /* Chrome/Safari */
			-moz-user-select: none; /* Firefox */
			-ms-user-select: none; /* IE10+ */

			/* Rules below not implemented in browsers yet */
			-o-user-select: none;
			user-select: none;

		}

		.ICD-10{
			line-height: 12px;
			margin-right:4px;
			color: black;
		}

		.iron-selected .ICD-10{
			color: var(--app-light-color);
		}

		.iron-selected .ICD-10 span{
			background: var(--app-light-color);
		}
		.ICD-10:hover{
			font-weight:600;
		}

		.ICD-10:hover:before{
			height:8px;
			width:8px;
			margin-bottom:0;
			border-radius:4px;
		}

		.ICD-10 span{
			content: '';
			display: inline-block;
			height: 6px;
			width: 6px;
			border-radius: 3px;
			margin-right: 3px;
			margin-bottom: 1px;
			background: lightgrey;
		}

		.contact .ICD-10:not(:first-child) {
			margin-left: 4px;
		}

		.contact p{
			@apply --paper-font-body1;
			margin:0;
			-webkit-user-select: none; /* Chrome/Safari */
			-moz-user-select: none; /* Firefox */
			-ms-user-select: none; /* IE10+ */

			/* Rules below not implemented in browsers yet */
			-o-user-select: none;
			user-select: none;
		}

		.contact-icon{
			position: absolute;
			right: 8px;
			margin: auto;
			top: 20px;
		}

		paper-material.iron-selected > .contact-icon{
			color:var(--app-text-color-light);
		}

		paper-material.iron-selected > .contact-text > .contact-text-date{
			color:var(--app-text-color-light)!important;
		}

		.current-contact {
			color:var(--app-secondary-color-dark);
			margin-bottom: 16px;
		}


		.current-contact.iron-selected{
			border-bottom:1px solid var(--app-primary-color);
		}

		.contact--big{
			min-height: 96px;
			/*@apply --padding-16;*/
			/*border-bottom: 1px solid var(--app-background-color-dark);*/
		}

		.contact--small{
			min-height: 32px;
			/*@apply --padding-right-left-16;*/
			padding-bottom: 8px;
		}

		.contact--small .contact-text-row:nth-child(2){
			justify-content: space-between;
		}

		.contact--small .contact-text-row:last-child{
			display: none;
		}

		.contact--small .he-dots-container{
			display:none;
		}

		.he-dots-container{
			display:flex;
			flex-flow:row wrap;
			justify-content: flex-end;
		}

		.contact-year{
			display:block;
			@apply --paper-font-body2;
			@apply --padding-32;
			padding-bottom:8px;
		}
		.contact-year:first-child{
			padding-top:0;
		}

		.contact-text{
			background:transparent;
			flex-direction:column;
			justify-content: space-between;
			align-items: flex-start;
			width:100%;
			height: 100%;
			padding:0;
		}

		.contact-text:focus::before, .contact-text:focus::after{
			background:transparent;
		}

		.contacts-container{
			overflow-y: auto;
			height: calc(100% - 80px);
			padding-bottom: 32px;
		}

		.layout.vertical {
			display: flex;
			flex-direction: row;
			justify-content: space-between;
			align-items: center;
			flex-wrap:nowrap;
		}

		.todo-list{
			border:1px dashed rgba(0,0,0,0.1);
			margin: 0 32px;
			border-radius:4px;
		}

		.todo-item{
			font-size:14px;
			--paper-item-min-height:32px;
			color:var(--app-text-color);
			display:flex;
			flex-flow: row wrap;
			align-items: center;
			justify-content: space-between;
		}

		.todo-item h4{
			margin:0.5em 0;
		}

		.todo-due-date{
			font-size:14px;
			font-weight:300;
			margin-right:4px;
		}

		.todo-actions paper-icon-button{
			height:24px;
			width:24px;
			padding:2px;
			--paper-icon-button-hover:{
				color:var(--app-secondary-color);
			};
		}

		.todo-item--late{
			color:var(--paper-red-500)
		}
		/* END SECOND PANEL */

		.second-third-panel{
			width:80%;
			height:calc(100% - 64px);
			background: var(--app-background-color);
			position:fixed;
			top:64px;
			right:0;
			z-index:2;
			overflow-y:scroll;
		}

		ht-pat-detail-ctc-detail-panel {
			grid-column: 3 / 3;
			grid-row: 1 / 1;
		}

		.statusContainer {
			display:inline-flex;
			flex-flow: row nowrap;
			justify-content: space-between;
			align-items: center;
			padding-top: 4px;
			padding-bottom: 4px;
			width: 100%;
			height: 24px;
			overflow: hidden;
		}

		#insuranceStatus, #hubStatus, #tlStatus, #consentStatus  {
			--paper-fab-background: var(--app-background-color-darker);
			--paper-fab-keyboard-focus-background: var(--app-background-color);
			color: var(--app-primary-color-dark);
			box-shadow: none;
			--paper-fab-iron-icon: {
				height:16px;
				width:16px;
			}

		}

		#insuranceStatus.medicalHouse {
			--paper-fab-background: var(--app-status-color-pending);
		}

		#insuranceStatus.noInsurance, #hubStatus.noAccess, #tlStatus.noTl, #consentStatus.noConsent {
			--paper-fab-background: var(--app-status-color-nok);
		}

		#insuranceStatus.insuranceOk, #hubStatus.accessOk, #tlStatus.tlOk, #consentStatus.consentOk {
			--paper-fab-background: var(--app-status-color-ok);
		}

		.display-left-menu{
			display:none;
			position:fixed;
			top: 50%;
			left: 0;
			z-index: 120;
			background: var(--app-background-color-dark);
			transform:translateY(-50%) rotate(0);
			border-radius:0 50% 50% 0;
			transition: transform 0.2s ease-in;

		}
		.display-left-menu.open{
			left:20%;
			border-radius:50% 0 0  50% ;
			transform:translateY(-50%) rotate(180deg);
			transition: transform 0.2s ease-in;
		}


		@media screen and (max-width:1025px){
			.container{
				grid-template-columns: 0% 40% 60%;

			}

			.container .fit-bottom{
				left:0%!important;
				width:40%;
			}
			.container.expanded{
				grid-template-columns: 20% 30% 50%;
			}

			.container.expanded .fit-bottom {
				left:20%!important;
				width:30%;
			}
			.selection-toast-button{
				@apply --paper-font-caption;
				text-transform:lowercase;
			}
			.second-third-panel{
				width:70%;
			}
			.patient-info-container{
				@apply --padding-right-left-16;
			}
			.patient-picture-container{
				display:none;
			}
			.btn-close{
				left: 8px;
				top: 16px;
			}
			.display-left-menu{
				display:inherit;
			}
		}

		.extraDialogFields paper-input, .extraDialogFields tk-token-field{
			--paper-input-container-focus-color: var(--app-primary-color);
		}

		.toast-detector {
			position: relative;
			height: 48px;
			bottom:48px;
			width:100%;
		}
		.saved{
			position: fixed;
			top:50%;
			right: 0;
			z-index:1000;
			color: white;
			font-size: 13px;
			background:rgba(0,0,0,0.42);
			height: 24px;
			padding: 0 8px 0 12px;
			border-radius: 3px 0 0 3px;
			width: 0;
			opacity: 0;
			animation: savedAnim 2.5s ease-in;
		}
		.saved iron-icon{
			margin-left: 4px;
			padding: 4px;
		}

		@keyframes savedAnim {
			0%{
				width: 0;
				opacity: 0;
			}
			20%{
				width: 80px;
				opacity: 1;
			}
			25%{
				width: 72px;
				opacity: 1;
			}
			75%{
				width: 72px;
				opacity: 1;
			}
			100%{
				width: 0;
				opacity: 0;
			}
		}
	</style>

	<div class="container">
		<paper-item id="savedIndicator">[[localize('saved','SAVED',language)]]
			<iron-icon icon="icons:check"></iron-icon>
		</paper-item>
		<template is="dom-if" if="[[isAdminSelected(selectedAdminFile)]]">
			<ht-pat-admin-card class="second-third-panel" id="pat-admin-card" api="[[api]]" user="[[user]]" patient="{{patient}}" language="[[language]]" resources="[[resources]]"></ht-pat-admin-card>
		</template>
		<paper-icon-button class="display-left-menu" icon="chevron-right" on-tap="_expandColumn"></paper-icon-button>
		<div class="first-panel">
			<paper-material class="zone compact-menu">
				<paper-listbox class="padding-0" id="adminFileMenu" selected-item="{{selectedAdminFile}}">
					<paper-item id="_admin_info" class="horizontal layout patient-info-container">
						<paper-fab class="btn-close" mini icon="close" on-tap="close"></paper-fab>
						<div class="patient-picture-container"><img src$="[[picture(patient)]]"></div>
						<div class="patient-info">
							<div class="patient-name">[[patient.firstName]] [[patient.lastName]]</div>
							<div class="patient-birthdate">°[[patient.dateOfBirth]]</div>
							<div class="statusContainer"><paper-fab id="insuranceStatus" mini icon="vaadin:handshake"></paper-fab><paper-fab id="consentStatus" mini icon="vaadin:clipboard-check"></paper-fab><paper-fab id="tlStatus" mini icon="vaadin:specialist"></paper-fab><paper-fab id="hubStatus" mini icon="vaadin:cluster"></paper-fab></div>
						</div>
					</paper-item>
					<paper-item class="menu-item" id="_complete_file">[[localize('com_fil','Complete file',language)]]<iron-icon class="menu-item-icon" icon="icons:arrow-forward"></iron-icon></paper-item>
				</paper-listbox>
				<div class="submenus-container">
					<paper-listbox class="padding-0" id="mainMenu" selected-items="{{selectedMainElements}}" multi toggle-shift>
						<collapse-button>
							<paper-item slot="sublist-collapse-item" class="menu-trigger menu-item" id="_ht_active_hes" on-tap="toggleSelectAll" elevation="">
								<div class="one-line-menu list-title"><span>[[localize('act_hea_pro','Active Health Problems',language)]]</span></div>
								<paper-icon-button class="menu-item-icon" icon="hardware:keyboard-arrow-down" on-tap="toggleMenu" hover="none"></paper-icon-button>
							</paper-item>
							<paper-listbox id="ahelb" class="menu-content sublist" multi toggle-shift on-selected-items-changed="selectedMainElementItemsChanged">
								<template is="dom-if" if="[[!activeHealthElements.length]]">
									<paper-item class="menu-item  list-info"><div class="one-line-menu">[[localize('no_act_hea_ele','No active health elements',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addHealthElement"></paper-icon-button></paper-item>
								</template>
								<template id="activeHesDomRepeat" is="dom-repeat" items="[[activeHealthElements]]" as="he">
									<ht-pat-he-tree-detail i18n="[[i18n]]" language="[[language]]" resources="[[resources]]" id="[[getHeId(he)]]" he="[[he]]" selected="[[isMainElementSelected(he,selectedMainElements,selectedMainElements.*)]]" on-selection-change="handleSelectionChange" on-edit-he="_editHealthElement" on-activate-he="_activate" on-archive-he="_archive" on-inactivate-he="_inactivate" on-select-he="selectHealthElement"></ht-pat-he-tree-detail>
								</template>
								<template is="dom-if" if="[[activeHealthElements.length]]">
									<paper-item class="menu-item sublist-footer"><div class="one-line-menu">[[localize('add_hea_ele','Add health element',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addHealthElement"></paper-icon-button></paper-item>
								</template>
							</paper-listbox>
						</collapse-button>
						<collapse-button>
							<paper-item slot="sublist-collapse-item" class="menu-trigger menu-item" id="_ht_inactive_hes" on-tap="toggleSelectAll" elevation="">
								<div class="one-line-menu list-title"><span>[[localize('med_ant','Medical antecedents',language)]]</span></div>
								<paper-icon-button class="menu-item-icon" icon="hardware:keyboard-arrow-down" on-tap="toggleMenu"></paper-icon-button>
							</paper-item>
							<paper-listbox id="ihelb" class="menu-content sublist" multi toggle-shift on-selected-items-changed="selectedMainElementItemsChanged">
								<template is="dom-if" if="[[!inactiveHealthElements.length]]">
									<paper-item class="menu-item list-info"><div class="one-line-menu">[[localize('no_med_ant','No medical antecedent',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addInactiveHealthElement"></paper-icon-button></paper-item>
								</template>
								<template id="inactiveHesDomRepeat" is="dom-repeat" items="[[inactiveHealthElements]]" as="he">
									<ht-pat-he-tree-detail i18n="[[i18n]]" language="[[language]]" resources="[[resources]]" id="[[getHeId(he)]]" he="[[he]]" selected="[[isMainElementSelected(he,selectedMainElements,selectedMainElements.*)]]" on-selection-change="handleSelectionChange" on-edit-he="_editHealthElement" on-activate-he="_activate" on-archive-he="_archive" on-inactivate-he="_inactivate"></ht-pat-he-tree-detail>
								</template>
								<template is="dom-if" if="[[inactiveHealthElements.length]]">
									<paper-item class="menu-item sublist-footer"><div class="one-line-menu">[[localize('add_med_ant','Add medical antecedent',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addInactiveHealthElement"></paper-icon-button></paper-item>
								</template>
							</paper-listbox>
						</collapse-button>
						<collapse-button>
							<paper-item slot="sublist-collapse-item" id="_svc_group_familyrisks" class="menu-trigger menu-item" on-tap="toggleSelectAll">
								<div class="one-line-menu list-title">[[localize('fam_ris','Family risks',language)]]</div>
								<paper-icon-button class="menu-item-icon" icon="hardware:keyboard-arrow-down" on-tap="toggleMenu"></paper-icon-button>
							</paper-item>
							<paper-listbox id="frhelb" class="menu-content sublist" multi toggle-shift on-selected-items-changed="selectedMainElementItemsChanged">
								<template is="dom-if" if="[[!familyrisks.length]]">
									<paper-item class="menu-item list-info"><div class="one-line-menu">[[localize('no_fam_ris','No family risks',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addService" data-label="Family risk" data-tags="CD-ITEM|familyrisk|1.0"></paper-icon-button></paper-item>
								</template>
								<template is="dom-repeat" items="[[familyrisks]]" as="risk">
									<ht-pat-he-tree-detail i18n="[[i18n]]" language="[[language]]" resources="[[resources]]" id="[[getHeId(he)]]" he="[[risk]]" selected="[[isMainElementSelected(he,selectedMainElements,selectedMainElements.*)]]" on-selection-change="handleSelectionChange" on-edit-he="_editHealthElement" on-activate-he="_activate" on-archive-he="_archive" on-inactivate-he="_inactivate"></ht-pat-he-tree-detail>
								</template>
								<template is="dom-if" if="[[familyrisks.length]]">
									<paper-item class="menu-item sublist-footer"><div class="one-line-menu">[[localize('add_fam_ris','Add family risk',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addService" data-label="Family risk" data-tags="CD-ITEM|familyrisk|1.0"></paper-icon-button></paper-item>
								</template>
							</paper-listbox>
						</collapse-button>
						</collapse-button>
						<collapse-button>
							<paper-item slot="sublist-collapse-item" id="_svc_group_risks" class="menu-trigger menu-item" on-tap="toggleSelectAll">
								<div class="one-line-menu list-title">[[localize('ris','Risks',language)]]</div>
								<paper-icon-button class="menu-item-icon" icon="hardware:keyboard-arrow-down" on-tap="toggleMenu"></paper-icon-button>
							</paper-item>
							<paper-listbox id="rhelb" class="menu-content sublist" multi toggle-shift on-selected-items-changed="selectedMainElementItemsChanged">
								<template is="dom-if" if="[[!risks.length]]">
									<paper-item class="menu-item list-info"><div class="one-line-menu">[[localize('no_ris','No risks',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addService" data-label="Risks" data-tags="CD-ITEM|risk|1.0"></paper-icon-button></paper-item>
								</template>
								<template is="dom-repeat" items="[[risks]]" as="risk">
									<ht-pat-he-tree-detail i18n="[[i18n]]" language="[[language]]" resources="[[resources]]" id="[[getHeId(he)]]" he="[[risk]]" selected="[[isMainElementSelected(he,selectedMainElements,selectedMainElements.*)]]" on-selection-change="handleSelectionChange" on-edit-he="_editHealthElement" on-activate-he="_activate" on-archive-he="_archive" on-inactivate-he="_inactivate"></ht-pat-he-tree-detail>
								</template>
								<template is="dom-if" if="[[risks.length]]">
									<paper-item class="menu-item sublist-footer"><div class="one-line-menu">[[localize('add_ris','Add risk',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addHealthElement" data-label="Risks" data-tags="CD-ITEM|risk|1.0"></paper-icon-button></paper-item>
								</template>
							</paper-listbox>
						</collapse-button>
						<collapse-button>
							<paper-item slot="sublist-collapse-item" id="_svc_group_allergies" class="menu-trigger menu-item" on-tap="toggleSelectAll">
								<div class="one-line-menu list-title">[[localize('all','Allergies',language)]]</div>
								<paper-icon-button class="menu-item-icon" icon="hardware:keyboard-arrow-down" on-tap="toggleMenu"></paper-icon-button>
							</paper-item>
							<paper-listbox id="alhelb" class="menu-content sublist" multi toggle-shift on-selected-items-changed="selectedMainElementItemsChanged">
								<template is="dom-if" if="[[!allergies.length]]">
									<paper-item class="menu-item list-info"><div class="one-line-menu">[[localize('no_all','No allergies',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addService" data-label="Allergies" data-tags="CD-ITEM|allergy|1.0"></paper-icon-button></paper-item>
								</template>
								<template is="dom-repeat" items="[[allergies]]" as="allergy">
									<ht-pat-he-tree-detail i18n="[[i18n]]" language="[[language]]" resources="[[resources]]" id="[[getHeId(he)]]" he="[[allergy]]" selected="[[isMainElementSelected(he,selectedMainElements,selectedMainElements.*)]]" on-selection-change="handleSelectionChange" on-edit-he="_editHealthElement" on-activate-he="_activate" on-archive-he="_archive" on-inactivate-he="_inactivate"></ht-pat-he-tree-detail>
								</template>
								<template is="dom-if" if="[[allergies.length]]">
									<paper-item class="menu-item sublist-footer"><div class="one-line-menu">[[localize('add_all','Add allergy',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addHealthElement" data-label="Allergies" data-tags="CD-ITEM|allergy|1.0"></paper-icon-button></paper-item>
								</template>
							</paper-listbox>
						</collapse-button>
						<collapse-button>
							<paper-item slot="sublist-collapse-item" id="_svc_group_medications" class="menu-trigger menu-item" on-tap="toggleSelectAll">
								<div class="one-line-menu list-title">[[localize('med','Medication',language)]]</div>
								<paper-icon-button class="menu-item-icon" icon="hardware:keyboard-arrow-down" on-tap="toggleMenu"></paper-icon-button>
							</paper-item>
							<paper-listbox id="mhelb" class="menu-content sublist" multi toggle-shift selected-items="{{selectedMedications}}">
								<template is="dom-if" if="[[!medications.length]]">
									<paper-item class="menu-item list-info"><div class="one-line-menu">[[localize('no_med','No medications',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addHealthElement" data-label="Medications" data-tags="CD-ITEM|medication|1.0"></paper-icon-button></paper-item>
								</template>
								<template is="dom-repeat" items="[[medications]]" as="medication">
									<paper-item class="menu-item" id="_svc_[[medication.id]]">
										<div class="one-line-menu">
											[[shortServiceDescription(medication, language)]]
										</div>
									</paper-item>
								</template>
								<template is="dom-if" if="[[medications.length]]">
									<paper-item class="menu-item sublist-footer"><div class="one-line-menu">[[localize('add_med','Add medication',language)]]</div><paper-icon-button class="menu-item-icon" icon="icons:add" on-tap="_addService" data-label="Medications" data-tags="CD-ITEM|medication|1.0"></paper-icon-button></paper-item>
								</template>
							</paper-listbox>
						</collapse-button>
						<collapse-button>
							<paper-item slot="sublist-collapse-item" class="menu-trigger menu-item" id="_ht_archived_hes" on-tap="toggleSelectAll" elevation="">
								<div class="one-line-menu list-title"><span>[[localize('arc','Archive',language)]]</span></div>
								<paper-icon-button class="menu-item-icon" icon="hardware:keyboard-arrow-down" on-tap="toggleMenu"></paper-icon-button>
							</paper-item>
							<paper-listbox id="arhelb" class="menu-content sublist" multi toggle-shift on-selected-items-changed="selectedMainElementItemsChanged">
								<template is="dom-if" if="[[!archivedHealthElements.length]]">
									<paper-item class="menu-item list-info"><div class="one-line-menu">[[localize('no_arc_hea_ele','No archived health elements',language)]]</div></paper-item>
								</template>
								<template id="archivedHesDomRepeat" is="dom-repeat" items="[[archivedHealthElements]]" as="he">
									<ht-pat-he-tree-detail i18n="[[i18n]]" language="[[language]]" resources="[[resources]]" id="[[getHeId(he)]]" he="[[he]]" selected="[[isMainElementSelected(he,selectedMainElements,selectedMainElements.*)]]" on-selection-change="handleSelectionChange" on-edit-he="_editHealthElement" on-activate-he="_activate" on-archive-he="_archive" on-inactivate-he="_inactivate"></ht-pat-he-tree-detail>
								</template>
							</paper-listbox>
						</collapse-button>
					</paper-listbox>
				</div>
			</paper-material>
			<div class="add-btn-container"><paper-button class="add-btn" on-tap="_addHealthElement">[[localize('add_heal_elem','Add Health Element',language)]]</paper-button></div>
		</div>
		<template is="dom-if" if="[[!isAdminSelected(selectedAdminFile)]]" restamp>
			<div class="second-panel">
				<div><filter-panel id="contactFilterPanel" items="[[secondPanelItems]]" selected-icon="{{contactType}}" search-string="{{contactSearchString}}" i18n="[[i18n]]" language="[[language]]" resources="[[resources]]"></filter-panel></div>
				<div class="contacts-container" on-scroll="openToast">
					<paper-listbox id="_contacts_listbox" focused multi toggle-shift selectable="paper-material" selected-items="{{selectedContactItems}}">
						<template is="dom-if" if="[[events.length]]">
							<span class="contact-year" on-click="openToast">[[localize('to_do','To Do',language)]]</span>
							<paper-listbox id="_events_listbox" class="todo-list">
								<template is="dom-repeat" items="[[events]]" as="e">
									<paper-item id="_svc_[[e.id]]" class$="todo-item [[_lateEventCssClass(e)]]">
										<h4><label class="todo-due-date">[[_dateFormat(e.valueDate)]]</label>[[shortServiceDescription(e)]]</h4>
										<div class="todo-actions">
											<paper-icon-button icon="clear" on-tap="clearEvent"></paper-icon-button>
											<paper-icon-button icon="done" on-tap="completeEvent"></paper-icon-button>
										</div>
									</paper-item>
								</template>
							</paper-listbox>
						</template>
						<template is="dom-if" if="[[!events.length]]">
						</template>
						<template is="dom-repeat" items="[[contactYears]]" as="contactYear">
								<span class="contact-year" on-click="openToast">
									[[contactYear.year]]
								</span>
							<template is="dom-repeat" items="[[contactYear.contacts]]" as="contact" filter="[[contactFilter(selectedMainElements, selectedMainElements.*, timeSpanStart, timeSpanEnd, contactSearchString, currentContact)]]" sort="compareContacts">
								<paper-material id="ctc_[[contact.id]]"
												elevation="0"
												class$="layout vertical contact [[_isLatestYearContact(contactYear, contactYears)]] [[_contactClasses(contact, contact.closingDate)]]"
												contact="[[contact]]"
												on-click="openToast">
									<paper-item class="contact-text">
										<div class="contact-text-row contact-text-date">
											<label>[[_timeFormat(contact.openingDate)]] ([[_shortId(contact.id)]])</label>
											<label>[[hcp(contact)]]</label>
										</div>
										<div class="contact-text-row grey">
											<h4>[[contact.userDescr]]</h4>
											<template is="dom-repeat" items="[[highlightedServiceLabels(user)]]"
													  as="label">
												<p>
													<template is="dom-repeat" items="[[serviceDescriptions(contact,label)]]" as="svcDesc">
														<template is="dom-if" if="[[!index]]">[[label]]:</template>
														<template is="dom-if" if="[[index]]"> ,</template>
														[[svcDesc]]
													</template>
												</p>

											</template>
										</div>
										<div class="contact-text-row label-container">
											<template is="dom-repeat" items="[[contact.healthElements]]" as="he">
												<label id="label_[[contact.id]]_[[getHeId(he)]]" class$="ICD-10 [[he.colour]]"><span></span>[[he.descr]]</label>
												<paper-tooltip for="label_[[contact.id]]_[[getHeId(he)]]">[[he.descr]]</paper-tooltip>
											</template>
										</div>
									</paper-item>
									<template is="dom-if" if="[[!contact.closingDate]]">
										<paper-icon-button id="close-[[contact.id]]" class="menu-item-icon contact-icon" icon="icons:cancel" on-tap="closeContact"></paper-icon-button>
									</template>
								</paper-material>
							</template>
						</template>
					</paper-listbox>
				</div>
				<div class="toast-detector" on-mousemove="openToast"></div>
				<paper-toast id="selectionToast" class="fit-bottom">
					<paper-button class="selection-toast-button" name="select-today" role="button" tabindex="0"
								  animated aria-disabled="false" elevation="0" on-tap="_selectToday">
						<iron-icon class="selection-toast-icon" icon="icure-svg-icons:select-today"></iron-icon>
						Select Today
					</paper-button>
					<paper-button class="selection-toast-button" name="select-six-months" role="button" tabindex="0"
								  animated aria-disabled="false" elevation="0" on-tap="_select6Months">
						<iron-icon class="selection-toast-icon"
								   icon="icure-svg-icons:select-six-months"></iron-icon>
						Last 6 Months
					</paper-button>
					<paper-button class="selection-toast-button" name="select-all" role="button" tabindex="0"
								  animated aria-disabled="false" elevation="0" on-tap="_selectAll">
						<iron-icon class="selection-toast-icon" icon="icure-svg-icons:select-all"></iron-icon>
						Select All
					</paper-button>
				</paper-toast>
				<template is="dom-if" if="[[!currentContact]]">
					<div class="new-ctc-btn-container"><paper-button class="add-btn" on-tap="newContact">[[localize('new_con','New Contact',language)]]</paper-button></div>
				</template>
			</div>
			<ht-pat-detail-ctc-detail-panel id="ctcDetailPanel" contacts="[[selectedContacts]]" all-contacts="[[contacts]]" health-elements="[[_concat(activeHealthElements,inactiveHealthElements)]]"
											api="[[api]]" i18n="[[i18n]]" user="[[user]]" patient="[[patient]]" language="[[language]]" resources="[[resources]]" current-contact="[[currentContact]]"
											on-select-current-contact="_selectCurrentContact" on-change="formsChanged" on-must-save-contact="_saveContact"></ht-pat-detail-ctc-detail-panel>
		</template>

	</div>

	<health-problem-selector id="add-healthelement-dialog" api="[[api]]" i18n="[[i18n]]" resources="[[resources]]" language="[[language]]" data-provider="[[_healthElementsSelectorDataProvider()]]" on-entity-selected="_addedHealthElementSelected" entity-type="Health Problem" entity="{{heEntity}}" ok-label="Create">
		<div class="extraDialogFields" slot="suffix">
		</div>
	</health-problem-selector>

	<health-problem-selector id="edit-healthelement-dialog" api="[[api]]" i18n="[[i18n]]" resources="[[resources]]" language="[[language]]" data-provider="[[_healthElementsSelectorDataProvider()]]" on-entity-selected="_editedHealthElementSelected" entity-type="Health Problem" entity="{{heEntity}}" ok-label="Modify">
		<div class="extraDialogFields" slot="suffix">
			<div class="history">[[localize('his','history',language)]]</div>
		</div>
	</health-problem-selector>

	<entity-selector id="add-service-dialog" i18n="[[i18n]]" language="[[language]]" resources="[[resources]]" columns="[[_servicesSelectorColumns()]]" data-provider="[[_servicesSelectorDataProvider(editedSvcLabel)]]" on-entity-selected="_addedOrEditedServiceSelected" entity-type="[[editedSvcLabel]]" entity="{{svcEntity}}" ok-label="Create">
		<div class="extraDialogFields" slot="suffix">
			<paper-input label="Description" value="[[shortServiceDescription(svcEntity, language)}}" on-value-changed="_svcEntityContentChanged"></paper-input>
		</div>
	</entity-selector>

	<entity-selector id="edit-service-dialog" i18n="[[i18n]]" language="[[language]]" resources="[[resources]]" columns="[[_servicesSelectorColumns()]]" data-provider="[[_servicesSelectorDataProvider(editedSvcLabel)]]" on-entity-selected="_addedOrEditedServiceSelected" entity-type="[[editedSvcLabel]]" entity="{{svcEntity}}" ok-label="Modify">
		<div class="extraDialogFields" slot="suffix">
			<paper-input label="Description" value="[[shortServiceDescription(svcEntity, language)}}" on-value-changed="_svcEntityContentChanged"></paper-input>
		</div>
	</entity-selector>

	</template>

  <script>class HtMesg extends Polymer.mixinBehaviors([], Polymer.Element) {
  static get is() {
    return 'ht-mesg';
  }

  static get properties() {
    return {};
  }

  constructor() {
    super();
  }

}

customElements.define(HtMesg.is, HtMesg);
</script>
</dom-module>
